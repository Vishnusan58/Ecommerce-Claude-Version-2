<div class="container">
  <h1>Admin Dashboard</h1>

  <!-- Stats Cards -->
  <div class="stats-grid">
    @if (isLoadingStats) {
      <mat-card class="stat-card">
        <mat-spinner diameter="30"></mat-spinner>
      </mat-card>
    } @else if (stats) {
      <mat-card class="stat-card">
        <mat-icon>attach_money</mat-icon>
        <div class="stat-content">
          <span class="stat-value">₹{{ stats.totalRevenue | number }}</span>
          <span class="stat-label">Total Revenue</span>
        </div>
      </mat-card>

      <mat-card class="stat-card">
        <mat-icon>shopping_bag</mat-icon>
        <div class="stat-content">
          <span class="stat-value">{{ stats.totalOrders }}</span>
          <span class="stat-label">Total Orders</span>
        </div>
      </mat-card>

      <mat-card class="stat-card">
        <mat-icon>people</mat-icon>
        <div class="stat-content">
          <span class="stat-value">{{ stats.totalUsers }}</span>
          <span class="stat-label">Total Users</span>
        </div>
      </mat-card>

      <mat-card class="stat-card premium">
        <mat-icon>star</mat-icon>
        <div class="stat-content">
          <span class="stat-value">{{ stats.premiumUsers }}</span>
          <span class="stat-label">Premium Users</span>
        </div>
      </mat-card>

      <mat-card class="stat-card">
        <mat-icon>store</mat-icon>
        <div class="stat-content">
          <span class="stat-value">{{ stats.totalSellers }}</span>
          <span class="stat-label">Sellers</span>
        </div>
      </mat-card>

      <mat-card class="stat-card warning">
        <mat-icon>pending_actions</mat-icon>
        <div class="stat-content">
          <span class="stat-value">{{ stats.pendingSellers }}</span>
          <span class="stat-label">Pending Sellers</span>
        </div>
      </mat-card>
    }
  </div>

  <!-- Tabs -->
  <mat-tab-group>
    <!-- Users Tab -->
    <mat-tab label="Users">
      <div class="tab-content">
        <div class="tab-header">
          <h2>Users ({{ usersTotalElements }})</h2>
          <mat-form-field appearance="outline">
            <mat-label>Filter by Role</mat-label>
            <mat-select [(ngModel)]="selectedRole" (selectionChange)="onRoleFilterChange()">
              <mat-option value="">All Roles</mat-option>
              @for (role of roles; track role) {
                <mat-option [value]="role">{{ role }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>

        @if (isLoadingUsers) {
          <div class="loading-container">
            <mat-spinner></mat-spinner>
          </div>
        } @else if (users.length === 0) {
          <div class="empty-state-small">
            <mat-icon>people_outline</mat-icon>
            <p>No users found</p>
          </div>
        } @else {
          <div class="users-grid">
            @for (user of users; track user.id) {
              <mat-card class="user-card">
                <div class="user-card-header">
                  <div class="avatar" [class.premium-avatar]="user.premiumStatus">
                    {{ user.name?.charAt(0)?.toUpperCase() || '?' }}
                  </div>
                  @if (user.premiumStatus) {
                    <mat-icon class="premium-badge-icon">star</mat-icon>
                  }
                </div>
                <div class="user-card-body">
                  <h4 class="user-name">{{ user.name || 'Unknown' }}</h4>
                  <p class="user-email">{{ user.email }}</p>
                  <div class="user-meta">
                    <span class="role-chip" [class]="'role-' + user.role?.toLowerCase()">
                      {{ user.role }}
                    </span>
                    @if (user.premiumStatus) {
                      <span class="premium-chip">Premium</span>
                    }
                  </div>
                </div>
                <div class="user-card-actions">
                  <mat-form-field appearance="outline" class="role-select">
                    <mat-label>Role</mat-label>
                    <mat-select [value]="user.role" (selectionChange)="changeUserRole(user, $event.value)">
                      @for (role of roles; track role) {
                        <mat-option [value]="role">{{ role }}</mat-option>
                      }
                    </mat-select>
                  </mat-form-field>
                  @if (user.premiumStatus) {
                    <button mat-stroked-button color="warn" (click)="cancelUserPremium(user)" class="revoke-btn">
                      <mat-icon>cancel</mat-icon>
                      Revoke
                    </button>
                  } @else {
                    <button mat-stroked-button color="primary" (click)="grantPremium(user)" class="grant-btn">
                      <mat-icon>star</mat-icon>
                      Grant Premium
                    </button>
                  }
                </div>
              </mat-card>
            }
          </div>

          <mat-paginator
            [length]="usersTotalElements"
            [pageSize]="usersPageSize"
            [pageIndex]="usersPageIndex"
            [pageSizeOptions]="[8, 16, 24]"
            (page)="onUsersPageChange($event)">
          </mat-paginator>
        }
      </div>
    </mat-tab>

    <!-- Pending Sellers Tab -->
    <mat-tab>
      <ng-template mat-tab-label>
        Pending Sellers
        @if (pendingSellers.length > 0) {
          <mat-chip class="tab-badge">{{ pendingSellers.length }}</mat-chip>
        }
      </ng-template>
      <div class="tab-content">
        <h2>Pending Seller Approvals</h2>

        @if (isLoadingPendingSellers) {
          <div class="loading-container">
            <mat-spinner></mat-spinner>
          </div>
        } @else if (pendingSellers.length === 0) {
          <div class="empty-state-small">
            <mat-icon>check_circle</mat-icon>
            <p>No pending seller applications</p>
          </div>
        } @else {
          <div class="pending-sellers">
            @for (seller of pendingSellers; track seller.id) {
              <mat-card class="seller-card">
                <div class="seller-info">
                  <div class="avatar">{{ seller.name.charAt(0).toUpperCase() }}</div>
                  <div>
                    <strong>{{ seller.name }}</strong>
                    <span class="email">{{ seller.email }}</span>
                  </div>
                </div>
                <div class="seller-actions">
                  <button mat-raised-button color="primary" (click)="approveSeller(seller)">
                    <mat-icon>check</mat-icon>
                    Approve
                  </button>
                  <button mat-stroked-button color="warn" (click)="rejectSeller(seller)">
                    <mat-icon>close</mat-icon>
                    Reject
                  </button>
                </div>
              </mat-card>
            }
          </div>
        }
      </div>
    </mat-tab>

    <!-- Coupons Tab -->
    <mat-tab label="Coupons">
      <div class="tab-content">
        <div class="tab-header">
          <h2>Coupons ({{ coupons.length }})</h2>
          <button mat-raised-button color="primary" (click)="showCouponForm = !showCouponForm">
            <mat-icon>{{ showCouponForm ? 'close' : 'add' }}</mat-icon>
            {{ showCouponForm ? 'Cancel' : 'Create Coupon' }}
          </button>
        </div>

        @if (showCouponForm) {
          <mat-card class="form-card">
            <form [formGroup]="couponForm" (ngSubmit)="createCoupon()">
              <div class="form-grid">
                <mat-form-field appearance="outline">
                  <mat-label>Coupon Code</mat-label>
                  <input matInput formControlName="code" placeholder="SAVE20">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Discount Type</mat-label>
                  <mat-select formControlName="discountType">
                    <mat-option value="PERCENTAGE">Percentage</mat-option>
                    <mat-option value="FIXED">Fixed Amount</mat-option>
                  </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Discount Value</mat-label>
                  <input matInput type="number" formControlName="discountValue">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Min Order Value (₹)</mat-label>
                  <input matInput type="number" formControlName="minOrderValue">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Max Discount (₹)</mat-label>
                  <input matInput type="number" formControlName="maxDiscount">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Usage Limit</mat-label>
                  <input matInput type="number" formControlName="usageLimit">
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Valid From</mat-label>
                  <input matInput [matDatepicker]="fromPicker" formControlName="validFrom">
                  <mat-datepicker-toggle matSuffix [for]="fromPicker"></mat-datepicker-toggle>
                  <mat-datepicker #fromPicker></mat-datepicker>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Valid Until</mat-label>
                  <input matInput [matDatepicker]="untilPicker" formControlName="validUntil">
                  <mat-datepicker-toggle matSuffix [for]="untilPicker"></mat-datepicker-toggle>
                  <mat-datepicker #untilPicker></mat-datepicker>
                </mat-form-field>
              </div>

              <button mat-raised-button color="primary" type="submit" [disabled]="isSubmitting">
                @if (isSubmitting) {
                  <mat-spinner diameter="20"></mat-spinner>
                } @else {
                  Create Coupon
                }
              </button>
            </form>
          </mat-card>
        }

        @if (isLoadingCoupons) {
          <div class="loading-container">
            <mat-spinner></mat-spinner>
          </div>
        } @else {
          <div class="coupons-grid">
            @for (coupon of coupons; track coupon.id) {
              <mat-card class="coupon-card">
                <div class="coupon-code">{{ coupon.code }}</div>
                <div class="coupon-details">
                  <p>
                    {{ coupon.discountType === 'PERCENTAGE' ? coupon.discountValue + '%' : '₹' + coupon.discountValue }} off
                  </p>
                  <p>Min order: ₹{{ coupon.minOrderValue | number }}</p>
                  <p>Valid: {{ coupon.validFrom | date:'shortDate' }} - {{ coupon.validUntil | date:'shortDate' }}</p>
                  <p>Used: {{ coupon.usedCount }}/{{ coupon.usageLimit }}</p>
                </div>
                <button mat-icon-button color="warn" (click)="deleteCoupon(coupon)">
                  <mat-icon>delete</mat-icon>
                </button>
              </mat-card>
            }
          </div>
        }
      </div>
    </mat-tab>

    <!-- Categories Tab -->
    <mat-tab label="Categories">
      <div class="tab-content">
        <div class="tab-header">
          <h2>Categories ({{ categories.length }})</h2>
          <button mat-raised-button color="primary" (click)="showCategoryForm = !showCategoryForm">
            <mat-icon>{{ showCategoryForm ? 'close' : 'add' }}</mat-icon>
            {{ showCategoryForm ? 'Cancel' : 'Add Category' }}
          </button>
        </div>

        @if (showCategoryForm) {
          <mat-card class="form-card">
            <form [formGroup]="categoryForm" (ngSubmit)="addCategory()">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Category Name</mat-label>
                <input matInput formControlName="name">
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Description (optional)</mat-label>
                <textarea matInput formControlName="description" rows="2"></textarea>
              </mat-form-field>

              <button mat-raised-button color="primary" type="submit" [disabled]="isSubmitting">
                @if (isSubmitting) {
                  <mat-spinner diameter="20"></mat-spinner>
                } @else {
                  Add Category
                }
              </button>
            </form>
          </mat-card>
        }

        @if (isLoadingCategories) {
          <div class="loading-container">
            <mat-spinner></mat-spinner>
          </div>
        } @else {
          <div class="categories-list">
            @for (category of categories; track category.id) {
              <mat-card class="category-card">
                <div class="category-info">
                  <strong>{{ category.name }}</strong>
                  @if (category.description) {
                    <p>{{ category.description }}</p>
                  }
                </div>
                <button mat-icon-button color="warn" (click)="deleteCategory(category)">
                  <mat-icon>delete</mat-icon>
                </button>
              </mat-card>
            }
          </div>
        }
      </div>
    </mat-tab>

    <!-- Verified Sellers Tab -->
    <mat-tab>
      <ng-template mat-tab-label>
        Sellers
        @if (verifiedSellers.length > 0) {
          <mat-chip class="tab-badge">{{ verifiedSellers.length }}</mat-chip>
        }
      </ng-template>
      <div class="tab-content">
        <h2>Verified Sellers</h2>

        @if (isLoadingVerifiedSellers) {
          <div class="loading-container">
            <mat-spinner></mat-spinner>
          </div>
        } @else if (verifiedSellers.length === 0) {
          <div class="empty-state-small">
            <mat-icon>store</mat-icon>
            <p>No verified sellers yet</p>
          </div>
        } @else {
          <div class="sellers-grid">
            @for (seller of verifiedSellers; track seller.id) {
              <mat-card class="seller-card-full">
                <div class="seller-header">
                  <div class="avatar large">{{ seller.name.charAt(0).toUpperCase() }}</div>
                  <div class="seller-details">
                    <strong>{{ seller.name }}</strong>
                    <span class="email">{{ seller.email }}</span>
                  </div>
                </div>
                <div class="seller-meta">
                  <span class="badge seller-badge">
                    <mat-icon>verified</mat-icon>
                    Verified Seller
                  </span>
                  @if (seller.premiumStatus) {
                    <span class="badge premium-badge">
                      <mat-icon>star</mat-icon>
                      Premium
                    </span>
                  }
                </div>
                <div class="seller-card-actions">
                  <button mat-stroked-button color="warn" (click)="deleteSeller(seller)">
                    <mat-icon>person_remove</mat-icon>
                    Remove Seller
                  </button>
                </div>
              </mat-card>
            }
          </div>
        }
      </div>
    </mat-tab>

    <!-- Products Tab -->
    <mat-tab label="Products">
      <div class="tab-content">
        <div class="tab-header">
          <h2>All Products ({{ productsTotalElements }})</h2>
        </div>

        @if (isLoadingProducts) {
          <div class="loading-container">
            <mat-spinner></mat-spinner>
          </div>
        } @else if (products.length === 0) {
          <div class="empty-state-small">
            <mat-icon>inventory_2</mat-icon>
            <p>No products found</p>
          </div>
        } @else {
          <div class="products-grid">
            @for (product of products; track getProductId(product)) {
              <mat-card class="product-card">
                <div class="product-image">
                  @if (product.imageUrl) {
                    <img [src]="product.imageUrl" [alt]="product.name">
                  } @else {
                    <mat-icon class="placeholder-icon">image</mat-icon>
                  }
                </div>
                <div class="product-info">
                  <h4>{{ product.name }}</h4>
                  <p class="product-category">{{ product.category?.name || 'Uncategorized' }}</p>
                  <div class="product-price">
                    <span class="price">₹{{ product.price | number }}</span>
                    @if (product.originalPrice && product.originalPrice > product.price) {
                      <span class="original-price">₹{{ product.originalPrice | number }}</span>
                    }
                  </div>
                  <p class="product-stock">Stock: {{ getProductStock(product) }}</p>
                </div>
                <div class="product-actions">
                  <button mat-icon-button color="warn" (click)="deleteProduct(product)" matTooltip="Delete Product">
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </mat-card>
            }
          </div>

          <mat-paginator
            [length]="productsTotalElements"
            [pageSize]="productsPageSize"
            [pageIndex]="productsPageIndex"
            [pageSizeOptions]="[6, 12, 24]"
            (page)="onProductsPageChange($event)">
          </mat-paginator>
        }
      </div>
    </mat-tab>

    <!-- Premium Users Tab -->
    <mat-tab>
      <ng-template mat-tab-label>
        Premium Users
        @if (premiumUsers.length > 0) {
          <mat-chip class="tab-badge premium">{{ premiumUsers.length }}</mat-chip>
        }
      </ng-template>
      <div class="tab-content">
        <h2>Premium Users</h2>

        @if (isLoadingPremiumUsers) {
          <div class="loading-container">
            <mat-spinner></mat-spinner>
          </div>
        } @else if (premiumUsers.length === 0) {
          <div class="empty-state-small">
            <mat-icon>star_border</mat-icon>
            <p>No premium users yet</p>
          </div>
        } @else {
          <div class="premium-users-grid">
            @for (user of premiumUsers; track user.id) {
              <mat-card class="premium-user-card">
                <div class="premium-user-header">
                  <div class="avatar premium-avatar">{{ user.name.charAt(0).toUpperCase() }}</div>
                  <div class="premium-user-info">
                    <strong>{{ user.name }}</strong>
                    <span class="email">{{ user.email }}</span>
                  </div>
                  <mat-icon class="premium-star">star</mat-icon>
                </div>
                <div class="premium-user-meta">
                  <span class="role-badge">{{ user.role }}</span>
                </div>
                <div class="premium-user-actions">
                  <button mat-stroked-button color="warn" (click)="cancelUserPremium(user)">
                    <mat-icon>cancel</mat-icon>
                    Revoke Premium
                  </button>
                </div>
              </mat-card>
            }
          </div>
        }
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
