<div class="container">
  <h1>
    <button mat-icon-button routerLink="/products">
      <mat-icon>arrow_back</mat-icon>
    </button>
    Compare Products
  </h1>

  @if (isLoading) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
    </div>
  }

  @if (!isLoading && product1 && product2) {
    <div class="compare-table">
      <!-- Header Row with Products -->
      <div class="compare-row header-row">
        <div class="compare-label"></div>
        <div class="compare-cell">
          <img [src]="product1.imageUrl" [alt]="product1.name" (click)="viewProduct(product1.id)">
          <h3 (click)="viewProduct(product1.id)">{{ product1.name }}</h3>
          <button mat-raised-button color="primary" (click)="addToCart(product1)" [disabled]="product1.stock === 0">
            <mat-icon>add_shopping_cart</mat-icon>
            {{ product1.stock === 0 ? 'Out of Stock' : 'Add to Cart' }}
          </button>
        </div>
        <div class="compare-cell">
          <img [src]="product2.imageUrl" [alt]="product2.name" (click)="viewProduct(product2.id)">
          <h3 (click)="viewProduct(product2.id)">{{ product2.name }}</h3>
          <button mat-raised-button color="primary" (click)="addToCart(product2)" [disabled]="product2.stock === 0">
            <mat-icon>add_shopping_cart</mat-icon>
            {{ product2.stock === 0 ? 'Out of Stock' : 'Add to Cart' }}
          </button>
        </div>
      </div>

      <!-- Comparison Rows -->
      @for (row of comparisonRows; track row.key) {
        <div class="compare-row">
          <div class="compare-label">{{ row.label }}</div>
          <div class="compare-cell" [class.better]="isBetter(row.key, getValue(product1, row.key), getValue(product2, row.key)) === 'product1'">
            @if (row.format === 'rating') {
              <div class="rating">
                @for (star of [1,2,3,4,5]; track star) {
                  <mat-icon>{{ star <= getValue(product1, row.key) ? 'star' : 'star_border' }}</mat-icon>
                }
                <span>({{ getValue(product1, 'reviewCount') }})</span>
              </div>
            } @else {
              {{ formatValue(getValue(product1, row.key), row.format) }}
            }
          </div>
          <div class="compare-cell" [class.better]="isBetter(row.key, getValue(product1, row.key), getValue(product2, row.key)) === 'product2'">
            @if (row.format === 'rating') {
              <div class="rating">
                @for (star of [1,2,3,4,5]; track star) {
                  <mat-icon>{{ star <= getValue(product2, row.key) ? 'star' : 'star_border' }}</mat-icon>
                }
                <span>({{ getValue(product2, 'reviewCount') }})</span>
              </div>
            } @else {
              {{ formatValue(getValue(product2, row.key), row.format) }}
            }
          </div>
        </div>
      }

      <!-- Description Row -->
      <div class="compare-row description-row">
        <div class="compare-label">Description</div>
        <div class="compare-cell">{{ product1.description }}</div>
        <div class="compare-cell">{{ product2.description }}</div>
      </div>
    </div>
  }
</div>
