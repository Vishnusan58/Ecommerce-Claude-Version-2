<div class="container">
  @if (isLoading) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
    </div>
  }

  @if (!isLoading && product) {
    <div class="product-detail">
      <!-- Image Gallery -->
      <div class="image-section">
        <div class="main-image">
          @if (product.premiumEarlyAccess) {
            <div class="premium-badge">Premium Early Access</div>
          }
          @if (discountPercent > 0) {
            <div class="discount-badge">-{{ discountPercent }}%</div>
          }
          <img [src]="selectedImage" [alt]="product.name">
        </div>
        @if (allImages.length > 1) {
          <div class="thumbnail-list">
            @for (img of allImages; track img) {
              <img [src]="img" [alt]="product.name" (click)="selectImage(img)" [class.selected]="img === selectedImage">
            }
          </div>
        }
      </div>

      <!-- Product Info -->
      <div class="info-section">
        <mat-chip-set>
          <mat-chip>{{ product.category.name }}</mat-chip>
          <mat-chip>{{ product.brand }}</mat-chip>
        </mat-chip-set>

        <h1 class="product-name">{{ product.name }}</h1>

        <div class="rating">
          @for (star of [1,2,3,4,5]; track star) {
            <mat-icon>{{ star <= product.rating ? 'star' : 'star_border' }}</mat-icon>
          }
          <span>{{ product.rating }}/5 ({{ product.reviewCount }} reviews)</span>
        </div>

        <div class="price-section">
          <span class="price">₹{{ product.price | number }}</span>
          @if (product.originalPrice && product.originalPrice > product.price) {
            <span class="original-price">₹{{ product.originalPrice | number }}</span>
            <span class="discount">Save ₹{{ (product.originalPrice - product.price) | number }}</span>
          }
        </div>

        <p class="stock-status" [class.out-of-stock]="product.stock === 0">
          @if (product.stock > 0) {
            <mat-icon>check_circle</mat-icon>
            In Stock ({{ product.stock }} available)
          } @else {
            <mat-icon>cancel</mat-icon>
            Out of Stock
          }
        </p>

        <div class="quantity-section">
          <label>Quantity:</label>
          <div class="quantity-controls">
            <button mat-icon-button (click)="decrementQuantity()" [disabled]="quantity <= 1">
              <mat-icon>remove</mat-icon>
            </button>
            <span class="quantity">{{ quantity }}</span>
            <button mat-icon-button (click)="incrementQuantity()" [disabled]="quantity >= product.stock">
              <mat-icon>add</mat-icon>
            </button>
          </div>
        </div>

        <div class="action-buttons">
          <button mat-raised-button color="primary" (click)="addToCart()" [disabled]="product.stock === 0" class="add-to-cart-btn">
            <mat-icon>add_shopping_cart</mat-icon>
            Add to Cart
          </button>
          <button mat-stroked-button (click)="toggleWishlist()" [color]="isInWishlist ? 'warn' : ''">
            <mat-icon>{{ isInWishlist ? 'favorite' : 'favorite_border' }}</mat-icon>
            {{ isInWishlist ? 'In Wishlist' : 'Add to Wishlist' }}
          </button>
        </div>

        <p class="seller-info">
          <mat-icon>store</mat-icon>
          Sold by: {{ product.sellerName || 'Unknown Seller' }}
        </p>
      </div>
    </div>

    <!-- Tabs for Description and Reviews -->
    <mat-tab-group class="mt-3">
      <mat-tab label="Description">
        <div class="tab-content">
          <p>{{ product.description }}</p>
        </div>
      </mat-tab>
      <mat-tab label="Reviews ({{ product.reviewCount }})">
        <div class="tab-content">
          <app-reviews [productId]="product.id"></app-reviews>
        </div>
      </mat-tab>
    </mat-tab-group>
  }
</div>
